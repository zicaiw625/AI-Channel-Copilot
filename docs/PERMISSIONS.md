# 权限说明 (Permissions Guide)

本文档说明 AI Channel Copilot 应用请求的各项 Shopify API 权限及其用途。

## 当前权限列表

| 权限 | 用途 | 必要性 | 涉及的数据 |
|-----|-----|-------|-----------|
| `read_orders` | 读取订单数据以进行 AI 渠道归因分析 | ✅ 必需 | 订单详情、referrer、UTM 参数 |
| `read_customers` | 读取客户数据以计算 LTV、复购率 | ✅ 必需 | 客户 ID、订单历史 |
| `read_products` | 读取产品数据以生成优化建议 | ✅ 必需 | 产品标题、描述、Schema 信息 |
| `read_checkouts` | 读取结账数据以构建转化漏斗 | ✅ 必需 | 结账会话、漏斗阶段 |
| `write_orders` | 写回 AI 渠道标签到订单 | ⚠️ 可选（用户可控） | 仅订单标签 |

## 已移除的权限

| 权限 | 原用途 | 移除原因 |
|-----|-------|---------|
| `write_customers` | ❌ 已移除 | 不需要写入 Shopify 客户数据，AI 获取状态仅存储在本地数据库 |

## 权限最小化原则

本应用遵循以下权限设计原则：

1. **只读优先**：优先使用读取权限，避免不必要的写入权限
2. **用户可控**：写入功能（如订单标签）默认关闭，由商家主动开启
3. **最小必要**：只请求业务功能所需的最小权限集
4. **透明说明**：向商家明确说明每项权限的用途

## 受保护客户数据 (Protected Customer Data)

根据 Shopify 2025 年 12 月生效的政策，访问受保护客户数据需要额外审批。

本应用对 PII（个人身份信息）的处理方式：

| 数据类型 | 是否收集 | 处理方式 |
|---------|---------|---------|
| 客户邮箱 | ❌ 不存储 | 仅存储 `hasEmail` 布尔值用于漏斗分析 |
| 客户姓名 | ❌ 不收集 | 仅使用匿名 ID |
| 客户地址 | ❌ 不收集 | - |
| 客户电话 | ❌ 不收集 | - |

我们**不收集或存储**任何个人身份信息 (PII)，仅使用匿名化的客户 ID 和布尔标记进行统计分析。

### 数据最小化实践

- **Checkout 数据**：不存储邮箱原文，仅存储 `hasEmail: Boolean` 用于判断用户登录状态
- **订单数据**：不存储客户姓名、地址、电话等 PII
- **数据保留**：所有数据按 `retentionMonths` 设置定期清理（默认 6 个月）

## 功能与权限对应表

### Free 计划
- `read_orders` - AI 订单检测（7 天）
- `read_products` - 基础产品信息

### Pro 计划
- `read_orders` - 完整 AI 归因分析（90 天）
- `read_customers` - LTV / 复购率分析
- `read_checkouts` - 转化漏斗分析
- `write_orders` - 订单标签写回（可选）

### Growth 计划
- 继承 Pro 所有权限
- 多店铺数据聚合（使用现有权限）

## 合规声明

1. 本应用已提交 Shopify 受保护客户数据访问申请
2. 所有数据处理符合 GDPR 和 CCPA 要求
3. 商家可随时在 Shopify Admin 中撤销授权

## 更新日志

- **2025-12-10**: 强化 PII 最小化 - 移除 Checkout.email 存储，改用 hasEmail 布尔标记
- **2025-12-09**: 移除 `write_customers` 权限，优化权限配置
- **2025-12-01**: 初始权限设置

---

如有权限相关问题，请联系：support@aichannelcopilot.com
